<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Antigravity-Proxy 路由配置工具</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="hero">
    <div class="hero-content">
      <p class="eyebrow">Antigravity-Proxy</p>
      <h1>规则路由配置工具</h1>
      <p class="subtitle">可视化编辑内网分流、域名通配符、端口与协议规则，直接导出 config.json。</p>
    </div>
    <div class="hero-actions">
      <label class="file-button">
        导入 config.json
        <input id="configFile" type="file" accept="application/json" />
      </label>
      <button id="btnDownload" class="primary">导出并下载</button>
      <button id="btnLoadExample" class="ghost">载入示例</button>
    </div>
  </header>

  <main class="layout">
    <section class="panel">
      <h2>全局路由设置</h2>
      <div class="grid">
        <label class="field">
          <span>启用路由</span>
          <input id="routingEnabled" type="checkbox" />
        </label>
        <label class="field">
          <span>优先级模式</span>
          <select id="priorityMode">
            <option value="order">按列表顺序（直觉）</option>
            <option value="number">按 priority 数值</option>
          </select>
        </label>
        <label class="field">
          <span>默认动作</span>
          <select id="defaultAction">
            <option value="proxy">proxy</option>
            <option value="direct">direct</option>
          </select>
        </label>
        <label class="field">
          <span>内置私网直连</span>
          <input id="useDefaultPrivate" type="checkbox" />
        </label>
      </div>
      <div id="priorityWarning" class="warning"></div>
    </section>

    <section class="panel split">
      <div class="rule-list">
        <div class="rule-list-header">
          <h2>规则列表</h2>
          <div class="rule-list-actions">
            <button id="btnAddRule">新增规则</button>
            <button id="btnCloneRule">复制规则</button>
            <button id="btnDeleteRule" class="danger">删除规则</button>
          </div>
        </div>
        <ul id="ruleList"></ul>
        <div class="rule-list-actions">
          <button id="btnMoveUp">上移</button>
          <button id="btnMoveDown">下移</button>
        </div>
      </div>

      <div class="rule-editor">
        <h2>规则详情</h2>
        <div class="grid">
          <label class="field">
            <span>名称</span>
            <input id="ruleName" type="text" />
          </label>
          <label class="field">
            <span>启用</span>
            <input id="ruleEnabled" type="checkbox" />
          </label>
          <label class="field">
            <span>动作</span>
            <select id="ruleAction">
              <option value="direct">direct</option>
              <option value="proxy">proxy</option>
            </select>
          </label>
          <label class="field">
            <span>priority（数字模式）</span>
            <input id="rulePriority" type="number" />
          </label>
        </div>
        <div class="grid two">
          <label class="field">
            <span>IPv4 CIDR（每行一条）</span>
            <textarea id="ruleIpv4" rows="4"></textarea>
          </label>
          <label class="field">
            <span>IPv6 CIDR（每行一条）</span>
            <textarea id="ruleIpv6" rows="4"></textarea>
          </label>
        </div>
        <div class="grid two">
          <label class="field">
            <span>域名通配符（每行一条）</span>
            <textarea id="ruleDomains" rows="4"></textarea>
          </label>
          <label class="field">
            <span>端口（如 443 或 10000-20000）</span>
            <textarea id="rulePorts" rows="4"></textarea>
          </label>
        </div>
        <label class="field">
          <span>协议（默认 tcp，可留空）</span>
          <input id="ruleProtocols" type="text" placeholder="tcp" />
        </label>
      </div>
    </section>

    <section class="panel">
      <h2>规则命中测试</h2>
      <div class="grid">
        <label class="field">
          <span>目标 Host/IP</span>
          <input id="testHost" type="text" placeholder="nas.local / 192.168.1.10" />
        </label>
        <label class="field">
          <span>端口</span>
          <input id="testPort" type="number" placeholder="443" />
        </label>
        <label class="field">
          <span>协议</span>
          <select id="testProto">
            <option value="tcp">tcp</option>
          </select>
        </label>
        <div class="field">
          <span>&nbsp;</span>
          <button id="btnTest" class="primary">测试</button>
        </div>
      </div>
      <div id="testResult" class="result"></div>
    </section>
  </main>

  <footer class="footer">
    <p>提示：优先级模式为“按列表顺序”时，规则顺序就是最终生效顺序；若选择“按 priority 数值”，数值越大优先级越高。</p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
